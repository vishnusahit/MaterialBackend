sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/MessageToast","dataupload/lib/xlsx","dataupload/lib/xlsxf","dataupload/lib/jszip","sap/m/Dialog","sap/m/TextArea","sap/m/Label","sap/m/Button","sap/ui/core/Fragment","sap/ui/model/json/JSONModel"],function(e,t,a,o,s,n,l,i,r,u,c,d){"use strict";return e.extend("dataupload.controller.Main",{async onReplicate(){var e=this.getOwnerComponent().getModel("odataV2");var t={ipMatnrs:["300.FIN.0009.212","300.FIN.0009.215","300.FIN.0009.207","300.FIN.0009.219","300.FIN.0009.206","300.FIN.0009.091","300.FIN.0009.106","300.FIN.0009.210","300.FIN.0009.152","300.FIN.0009.155","300.FIN.0009.222","300.FIN.0009.201","300.FIN.0009.186","300.FIN.0009.199","300.FIN.0009.216","300.FIN.0009.146","300.FIN.0009.208","300.FIN.0009.217","300.FIN.0009.200","300.FIN.0009.141","300.FIN.0009.213","300.FIN.0009.150","300.FIN.0009.161","300.FIN.0009.108","300.FIN.0009.197","300.FIN.0009.163","300.FIN.0009.205","300.SME.0009.108","300.FIN.0009.159","300.FIN.0009.195"]};await e.create("/replicateToS4Hana",t,{method:"POST",success:function(e){debugger;sap.m.MessageToast.show("Data Fetched Kindly Refresh")},error:function(e){console.error("Error during action call:",e);sap.m.MessageToast.show("Action execution failed.");if(e.responseText){console.error("Response text:",e.responseText)}if(e.message){console.error("Error message:",e.message)}}})},onInit:function(){var e=this.getView().getModel("odataV2");var t=localStorage.getItem("draftData");if(t){var a=JSON.parse(t);var e=new sap.ui.model.json.JSONModel(a);this.getView().setModel(e,"ExcelData")}},onBeforeOpen:function(e){var t=e.getSource();var a=this.getView().byId("idExceluploader");a.clear();this.getView().byId("confirmButton").setEnabled(false)},onAfterClose:function(e){var t=e.getSource();var a=this.getView().byId("idExceluploader");a.clear();t.destroy()},onFileAllowed:function(e){this.getView().byId("confirmButton").setEnabled(true)},onFileEmpty:function(e){this.getView().byId("confirmButton").setEnabled(false)},onTypeMismatch:function(e){var a=e.getSource().getFileType().map(function(e){return"*."+e}).join(", ");t.error("The file type *."+e.getParameter("fileType")+" is not supported. Choose one of the following types: "+a)},onUploadComplete:function(e){a.show("File upload complete")},onOk:function(e){var t=e.getSource().getParent();var o=this.getView().byId("idExceluploader");var s=o.oFileUpload.files[0];if(!s){a.show("Please select an Excel file.");return}var n=new FileReader;n.onload=e=>{var a=e.target.result;var o=XLSX.read(a,{type:"binary"});var s=o.SheetNames[0];var n=o.Sheets[s];var l=XLSX.utils.sheet_to_json(n);var i=new sap.ui.model.json.JSONModel(l);this.getView().setModel(i,"ExcelData");this.uploadData(l);t.close();t.destroy();this._exDialog=undefined};n.onerror=e=>{a.show("Error reading file: "+e)};n.readAsBinaryString(s)},uploadData:async function(e){var o=this.getView().getModel("odataV2");var s=[];e.forEach(function(e){s.push(new Promise(function(t,a){o.create("/mara_dummy",e,{success:function(e){t(e)},error:function(e){console.log(e);a(e)}})}))});Promise.all(s).then(function(e){a.show("All data uploaded successfully!");o.submitChanges({success:function(){a.show("Data saved successfully!");o.refresh(true)},error:function(e){t.error("Failed to save changes: "+e.message)}})}).catch(function(e){t.error("Upload failed: "+e.message)})},onDelete:function(){var e=this.getView().byId("rulesTable");var t=e.getSelectedItems();if(t.length>0){var o=this.getView().getModel("ExcelData");var s=o.getData();t.reverse().forEach(function(e){s.splice(e,1)});o.setData(s);o.refresh();a.show("Selected row(s) deleted successfully.");t.forEach(function(e){e.setSelected(false)})}else{a.show("Please select at least one row to delete.")}},onEdit:function(){var e=this.getView().byId("rulesTable");var t=e.getSelectedItems();if(t.length===1){var a=this.getView().getModel("ExcelData");var o=a.getData();var s=e.indexOfItem(t[0]);var n=o[s];var l=new sap.m.Dialog({title:"Edit Rule",content:[new sap.m.Label({text:"Table Name",labelFor:"tableName"}),new sap.m.Input("tableName",{value:n.Table_name,width:"100%"}),new sap.m.Label({text:"Column Name",labelFor:"columnName"}),new sap.m.Input("columnName",{value:n.Column_name,width:"100%"}),new sap.m.Label({text:"Column Description",labelFor:"columnDescription"}),new sap.m.Input("columnDescription",{value:n.Column_description,width:"100%"}),new sap.m.Label({text:"Business Rule Name",labelFor:"businessRuleName"}),new sap.m.Input("businessRuleName",{value:n.Business_rule_name,width:"100%"}),new sap.m.Label({text:"Rule Type",labelFor:"ruleType"}),new sap.m.Input("ruleType",{value:n.Rule_type,width:"100%"}),new sap.m.Label({text:"Rule Definition",labelFor:"ruleDefinition"}),new sap.m.TextArea("ruleDefinition",{value:n.Rule_Definition,width:"100%",rows:4})],beginButton:new sap.m.Button({text:"Save",press:function(){var t=sap.ui.getCore().byId("tableName").getValue();var n=sap.ui.getCore().byId("columnName").getValue();var i=sap.ui.getCore().byId("columnDescription").getValue();var r=sap.ui.getCore().byId("businessRuleName").getValue();var u=sap.ui.getCore().byId("ruleType").getValue();var c=sap.ui.getCore().byId("ruleDefinition").getValue();o[s].Table_name=t;o[s].Column_name=n;o[s].Column_description=i;o[s].Business_rule_name=r;o[s].Rule_type=u;o[s].Rule_Definition=c;a.setData(o);a.refresh();e.getItems()[s].setSelected(false);sap.m.MessageToast.show("Rule updated successfully.");l.close()}}),endButton:new sap.m.Button({text:"Cancel",press:function(){l.close()}}),afterClose:function(){l.destroy()}});this.getView().addDependent(l);l.open()}else{sap.m.MessageToast.show("Please select exactly one row to edit.")}},onExcelUploadBtnPress:function(){if(!this._exDialog){this._exDialog=c.load({id:this.getView().getId(),name:"dataupload.view.fragments.uploadExcel",controller:this}).then(function(e){this.getView().addDependent(e);e.open()}.bind(this))}else{this._exDialog.then(function(e){e.open()})}},onCancel:function(e){var t=e.getSource().getParent();t.close();t.destroy();this._exDialog=undefined},onDownloadTemplate:function(){var e=[{Table_name:"",Column_name:"",Column_description:"",Business_rule_name:"",Rule_type:"",Rule_Definition:""}];var t=XLSX.utils.json_to_sheet(e);var o=XLSX.utils.book_new();XLSX.utils.book_append_sheet(o,t,"Template");var s="template.xlsx";XLSX.writeFile(o,s);a.show("Template downloaded successfully!")},onBeforeOpenDuplicates:function(e){var t=e.getSource();var a=this.getView().getModel("duplicatesModel");if(a){a.refresh()}},onAfterCloseDuplicates:function(e){oExtensionAPI.removeDependent(oUploadDialog);oUploadDialog.destroy();oUploadDialog=undefined},onCancelDuplicates:function(e){var t=e.getSource().getParent();t.close();t.destroy()},closeDialog:function(){oUploadDialog&&oUploadDialog.close()},onCreate:function(){var e;var t=new d;var o="https://py_mdg_duplicate_chk.cfapps.us10-001.hana.ondemand.com/result";$.ajax({url:o,method:"GET",dataType:"json",contentType:"application/json",data:e,success:function(e){sap.ui.core.BusyIndicator.hide();console.log("Data received: ",e);t.setData(e);a.show("Data loaded successfully.")},error:function(e){sap.ui.core.BusyIndicator.hide();a.show("Failed to load data from the Python service.")}});this.loadFragment({id:"uploadDialog",name:"dataupload.view.fragments.duplicate",controller:this}).then(function(e){e.setModel(t,"duplicatesModel");e.open()})},onDraftPress:function(){var e=this.getView().getModel("ExcelData");var t=e.getData();localStorage.setItem("draftData",JSON.stringify(t));a.show("Data as Draft saved successfully!")}})});
//# sourceMappingURL=Main.controller.js.map